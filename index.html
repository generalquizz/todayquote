<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Today Quote</title>

<!-- ================= STYLE (نفس التنسيق الأصلي) ================= -->
<style>
body{
  margin:0;
  font-family:Tahoma, Arial;
  background:#f4f4f4;
  color:#333;
}
header{
  background:#222;
  color:#fff;
  padding:25px 10px;
  text-align:center;
}
#quote{
  font-size:20px;
  opacity:.9;
}

/* زر مخفي */
#secretBtn{
  position:fixed;
  bottom:8px;
  left:8px;
  width:25px;
  height:25px;
  background:#f4f4f4;
  border:none;
  cursor:pointer;
}

/* ================= CHAT ================= */
#chatOverlay{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.75);
  justify-content:center;
  align-items:center;
  z-index:999;
}
#chatBox{
  width:360px;
  height:520px;
  background:#fff;
  border-radius:10px;
  display:flex;
  flex-direction:column;
  overflow:hidden;
}
#chatHeader{
  background:#222;
  color:#fff;
  padding:10px;
  text-align:center;
}
#messages{
  flex:1;
  padding:10px;
  overflow-y:auto;
}
.msg{
  margin:6px 0;
  padding:8px 12px;
  border-radius:6px;
  max-width:80%;
  font-size:14px;
}
.me{background:#d1f1ff; margin-left:auto;}
.other{background:#eee; margin-right:auto;}
#inputArea{
  display:flex;
  border-top:1px solid #ccc;
}
#inputArea input{
  flex:1;
  padding:10px;
  border:none;
  outline:none;
}
#inputArea button{
  padding:10px 15px;
  background:#222;
  color:#fff;
  border:none;
  cursor:pointer;
}
</style>

<!-- ================= FIREBASE SDK ================= -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
</head>
<body>

<header>
  <div id="quote">حكمة اليوم: الصمت أحيانًا أبلغ من الكلام</div>
</header>

<button id="secretBtn"></button>

<div id="chatOverlay">
  <div id="chatBox">
    <div id="chatHeader">Private Chat</div>
    <div id="messages"></div>
    <div id="inputArea">
      <input id="msgInput" placeholder="اكتب رسالة..." />
      <button onclick="sendMsg()">إرسال</button>
    </div>
  </div>
</div>

<script>
/* ================= FIREBASE CONFIG ================= */
const firebaseConfig = {
  apiKey: "AIzaSyDBADAFbHjg8Dq10vR1l9yMImoBSFs_70M",
  authDomain: "todayquote-3a22b.firebaseapp.com",
  databaseURL: "https://todayquote-3a22b-default-rtdb.firebaseio.com",
  projectId: "todayquote-3a22b",
  storageBucket: "todayquote-3a22b.firebasestorage.app",
  messagingSenderId: "10962691980",
  appId: "1:10962691980:web:a38f4e91310cccba0998a9"
};
firebase.initializeApp(firebaseConfig);

const db = firebase.database();
const chatRef = db.ref('chat');

/* ================= AUTH (كما هو بدون تغيير) ================= */
firebase.auth().signInAnonymously().catch(()=>{});

/* ================= USER ID (كما هو) ================= */
let uid = localStorage.getItem('uid');
if(!uid){
  uid = Math.random().toString(36).substring(2);
  localStorage.setItem('uid',uid);
}

/* ================= UI CONTROL (كما هو) ================= */
const overlay = document.getElementById('chatOverlay');
document.getElementById('secretBtn').onclick = ()=>{
  const p = prompt('كلمة المرور');
  if(p === 'blobif') overlay.style.display='flex';
};

/* ================= SEND MESSAGE (نفس الدالة) ================= */
function sendMsg(){
  const input = document.getElementById('msgInput');
  if(input.value.trim()==='') return;

  const msgRef = chatRef.push();
  msgRef.set({
    text: input.value,
    uid: uid,
    time: Date.now()
  });

  // تدمير ذاتي بعد 5 ثواني
  setTimeout(()=>{
    msgRef.remove();
  },5000);

  input.value='';
}

/* ================= RECEIVE MESSAGE (كما هو) ================= */
chatRef.on('child_added', snap=>{
  const data = snap.val();
  if(!data) return;

  const div = document.createElement('div');
  div.className = 'msg ' + (data.uid===uid ? 'me':'other');
  div.textContent = data.text;

  document.getElementById('messages').appendChild(div);
  document.getElementById('messages').scrollTop = 999999;

  // حذف من الواجهة بعد 5 ثواني
  setTimeout(()=>{
    div.remove();
  },5000);
});
</script>
</body>
</html>
