<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Today Quote</title>

<style>
*{box-sizing:border-box}
body{margin:0;font-family:Tahoma, Arial;background:#f4f4f4;color:#333}
header{background:#222;color:#fff;padding:25px 10px;text-align:center}
#quote{font-size:18px;line-height:1.6}

#secretBtn{
  position:fixed;
  bottom:12px;
  left:12px;
  width:40px;
  height:40px;
  background:#f4f4f4;
  border:none;
  cursor:pointer;
  z-index:1000;
}

#passwordOverlay,#blockOverlay,#chatOverlay{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.8);
  justify-content:center;
  align-items:center;
  z-index:2000;
}

.box{
  background:#fff;
  width:90%;
  max-width:340px;
  padding:20px;
  border-radius:10px;
  text-align:center;
}

input,button{width:100%;padding:12px;font-size:16px;margin-top:10px}
button{background:#222;color:#fff;border:none}

#chatBox{
  width:100%;
  max-width:420px;
  height:100%;
  max-height:600px;
  background:#fff;
  display:flex;
  flex-direction:column;
}
#chatHeader{background:#222;color:#fff;padding:12px;text-align:center}
#messages{flex:1;padding:12px;overflow-y:auto}
.msg{margin:8px 0;padding:10px 14px;border-radius:18px;max-width:80%;font-size:14px;word-wrap:break-word}
.me{background:#d1f1ff;margin-left:auto}
.other{background:#eee;margin-right:auto}
#inputArea{display:flex;border-top:1px solid #ccc}
#inputArea input{flex:1;border:none}
#inputArea button{width:auto;padding:0 18px}
</style>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
</head>
<body>

<header>
  <div id="quote">حكمة اليوم: الخصوصية الحقيقية تبدأ بالتحكم</div>
</header>

<button id="secretBtn"></button>

<div id="passwordOverlay"><div class="box"><div>أدخل كلمة المرور</div><input id="passwordInput" type="password"><button id="passwordBtn">دخول</button></div></div>

<div id="blockOverlay"><div class="box">⚠️ الشات مستخدم حالياً بين طرفين فقط<br><br>لا يمكن دخول طرف ثالث</div></div>

<div id="chatOverlay"><div id="chatBox">
  <div id="chatHeader">Private Chat (2 Users Only)</div>
  <div id="messages"></div>
  <div id="inputArea"><input id="msgInput" placeholder="اكتب رسالة..."><button onclick="sendMsg()">إرسال</button></div>
</div></div>

<script>
const firebaseConfig={
 apiKey:"AIzaSyDBADAFbHjg8Dq10vR1l9yMImoBSFs_70M",
 authDomain:"todayquote-3a22b.firebaseapp.com",
 databaseURL:"https://todayquote-3a22b-default-rtdb.firebaseio.com",
 projectId:"todayquote-3a22b",
 storageBucket:"todayquote-3a22b.firebasestorage.app",
 messagingSenderId:"10962691980",
 appId:"1:10962691980:web:a38f4e91310cccba0998a9"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();
firebase.auth().signInAnonymously();

let uid=localStorage.getItem('uid');
if(!uid){uid=Math.random().toString(36).slice(2);localStorage.setItem('uid',uid)}

const usersRef=db.ref('presence');
const chatRef=db.ref('chat');

const secretBtn=document.getElementById('secretBtn');
const passwordBtn=document.getElementById('passwordBtn');
const passOverlay=document.getElementById('passwordOverlay');
const chatOverlay=document.getElementById('chatOverlay');
const blockOverlay=document.getElementById('blockOverlay');

secretBtn.onclick=()=>passOverlay.style.display='flex';

passwordBtn.onclick=()=>{
 if(passwordInput.value!=='blobif')return;
 usersRef.once('value',snap=>{
  const users=snap.val()||{};
  if(Object.keys(users).length>=2 && !users[uid]){
    passOverlay.style.display='none';
    blockOverlay.style.display='flex';
  }else{
    usersRef.child(uid).set(true);
    usersRef.child(uid).onDisconnect().remove();
    passOverlay.style.display='none';
    chatOverlay.style.display='flex';
  }
 });
};

function sendMsg(){
 const i=msgInput;
 if(!i.value.trim())return;
 const r=chatRef.push();
 r.set({text:i.value,uid,time:Date.now()});
 setTimeout(()=>r.remove(),5000);
 i.value='';
}

chatRef.on('child_added',s=>{
 const d=s.val(); if(!d)return;
 const m=document.createElement('div');
 m.className='msg '+(d.uid===uid?'me':'other');
 m.textContent=d.text;
 messages.appendChild(m);
 messages.scrollTop=messages.scrollHeight;
 setTimeout(()=>m.remove(),5000);
});
</script>
</body>
</html>
