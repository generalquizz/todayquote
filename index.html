<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Today Quote</title>

<!-- ================= MOBILE FIRST STYLE ================= -->
<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Tahoma, Arial;
  background:#f4f4f4;
  color:#333;
  -webkit-text-size-adjust:100%;
}
header{
  background:#222;
  color:#fff;
  padding:20px 10px;
  text-align:center;
}
#quote{
  font-size:18px;
  line-height:1.6;
}

/* زر مخفي */
#secretBtn{
  position:fixed;
  bottom:10px;
  left:10px;
  width:32px;
  height:32px;
  background:#f4f4f4;
  border:none;
}

/* ================= CHAT ================= */
#chatOverlay{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.85);
  justify-content:center;
  align-items:center;
  z-index:9999;
}
#chatBox{
  width:100%;
  max-width:420px;
  height:100%;
  max-height:600px;
  background:#fff;
  display:flex;
  flex-direction:column;
}
#chatHeader{
  background:#222;
  color:#fff;
  padding:12px;
  text-align:center;
  font-size:16px;
}
#messages{
  flex:1;
  padding:12px;
  overflow-y:auto;
  -webkit-overflow-scrolling:touch;
}
.msg{
  margin:8px 0;
  padding:10px 14px;
  border-radius:18px;
  max-width:80%;
  font-size:14px;
  word-wrap:break-word;
}
.me{background:#d1f1ff; margin-left:auto}
.other{background:#eee; margin-right:auto}
#inputArea{
  display:flex;
  border-top:1px solid #ccc;
}
#inputArea input{
  flex:1;
  padding:14px;
  border:none;
  outline:none;
  font-size:15px;
}
#inputArea button{
  padding:0 18px;
  background:#222;
  color:#fff;
  border:none;
  font-size:15px;
}

/* iPhone safe area */
@supports(padding:max(0px)){
  #chatBox{padding-bottom:env(safe-area-inset-bottom)}
}
</style>

<!-- ================= FIREBASE SDK ================= -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
</head>
<body>

<header>
  <div id="quote">حكمة اليوم: الصمت أحيانًا أبلغ من الكلام</div>
</header>

<button id="secretBtn"></button>

<div id="chatOverlay">
  <div id="chatBox">
    <div id="chatHeader">Private Chat</div>
    <div id="messages"></div>
    <div id="inputArea">
      <input id="msgInput" placeholder="اكتب رسالة..." autocomplete="off" />
      <button onclick="sendMsg()">إرسال</button>
    </div>
  </div>
</div>

<script>
/* ================= FIREBASE CONFIG ================= */
const firebaseConfig = {
  apiKey: "AIzaSyDBADAFbHjg8Dq10vR1l9yMImoBSFs_70M",
  authDomain: "todayquote-3a22b.firebaseapp.com",
  databaseURL: "https://todayquote-3a22b-default-rtdb.firebaseio.com",
  projectId: "todayquote-3a22b",
  storageBucket: "todayquote-3a22b.firebasestorage.app",
  messagingSenderId: "10962691980",
  appId: "1:10962691980:web:a38f4e91310cccba0998a9"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const chatRef = db.ref('chat');

/* ================= AUTH ================= */
firebase.auth().signInAnonymously().catch(()=>{});

/* ================= USER ID ================= */
let uid = localStorage.getItem('uid');
if(!uid){uid=Math.random().toString(36).slice(2);localStorage.setItem('uid',uid)}

/* ================= UI ================= */
const overlay=document.getElementById('chatOverlay');
document.getElementById('secretBtn').onclick=()=>{
  const p=prompt('كلمة المرور');
  if(p==='blobif') overlay.style.display='flex';
};

/* ================= SEND ================= */
function sendMsg(){
  const input=document.getElementById('msgInput');
  if(!input.value.trim()) return;

  const ref=chatRef.push();
  ref.set({text:input.value,uid:uid,time:Date.now()});

  setTimeout(()=>{ref.remove()},5000);
  input.value='';
}

/* ================= RECEIVE ================= */
chatRef.on('child_added',snap=>{
  const d=snap.val();
  if(!d) return;

  const div=document.createElement('div');
  div.className='msg '+(d.uid===uid?'me':'other');
  div.textContent=d.text;

  const box=document.getElementById('messages');
  box.appendChild(div);
  box.scrollTop=box.scrollHeight;

  setTimeout(()=>{div.remove()},5000);
});
</script>
</body>
</html>
