<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ù…Ø¯ÙˆÙ†Ø© Ø®Ø§ØµØ©</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:Tahoma;background:#f4f4f4;color:#222;height:100vh;overflow:hidden}
/* ===== Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Ù…Ø¯ÙˆÙ†Ø©) ===== */
#blog{display:flex;flex-direction:column;height:100vh}
header{background:#fff;padding:20px;text-align:center;border-bottom:1px solid #ddd}
header h1{margin:0;font-size:22px}
header p{margin:8px 0 0;color:#555}
main{flex:1;padding:20px;overflow-y:auto}
article{background:#fff;padding:15px;border-radius:8px;box-shadow:0 0 5px rgba(0,0,0,.1)}
/* Ø²Ø± Ù…Ø®ÙÙŠ */
#secretBtn{position:fixed;bottom:5px;left:5px;width:30px;height:30px;background:#f4f4f4;border:none;cursor:pointer}
/* ===== ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø´Ø§Øª ===== */
#chatScreen{display:none;position:fixed;inset:0;background:#0f172a;color:#fff;z-index:10}
.chatBox{max-width:420px;margin:20px auto;background:#020617;border-radius:12px;display:flex;flex-direction:column;height:90vh}
.chatBox header{background:#020617;color:#22c55e;border:none}
#messages{flex:1;overflow-y:auto;padding:10px}
.msg{margin:6px 0;padding:8px 12px;border-radius:10px;max-width:80%}
.me{background:#2563eb;margin-left:auto}
.other{background:#334155}
footer{display:flex;padding:10px;gap:6px}
input{flex:1;padding:10px;border-radius:8px;border:none}
button{padding:10px 14px;border:none;border-radius:8px;background:#22c55e;font-weight:bold;cursor:pointer}
#closeChat{background:#ef4444;color:#fff}
/* Ø´Ø§Ø´Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± */
#lock{position:absolute;inset:0;display:flex;justify-content:center;align-items:center;background:#020617}
.lockBox{background:#020617;padding:20px;border-radius:10px;text-align:center}
.lockBox input{margin-top:10px;width:100%}
</style>
</head>
<body>

<!-- ===== Ø§Ù„Ù…Ø¯ÙˆÙ†Ø© ===== -->
<div id="blog">
  <header>
    <h1>Ù…Ø¯ÙˆÙ†Ø© Ø®Ø§ØµØ©</h1>
    <p>Ø­ÙƒÙ…Ø© Ø§Ù„ÙŠÙˆÙ…: "Ø§Ù„ØµÙ…Øª Ø£Ø­ÙŠØ§Ù†Ù‹Ø§ Ø£Ø¨Ù„Øº Ù…Ù† Ø§Ù„ÙƒÙ„Ø§Ù…"</p>
  </header>
  <main>
    <article>
      <h3>Ù…Ù‚Ø§Ù„ Ø§Ù„ÙŠÙˆÙ…</h3>
      <p>Ù‡Ø°Ù‡ Ù…Ø¬Ø±Ø¯ ÙˆØ§Ø¬Ù‡Ø© ØªØ¨Ø¯Ùˆ ÙƒÙ…Ø¯ÙˆÙ†Ø© Ø¹Ø§Ø¯ÙŠØ© ÙˆÙ„Ø§ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£ÙŠ Ø¯Ù„Ø§Ù„Ø© Ù„ÙˆØ¬ÙˆØ¯ Ø´Ø§Øª.</p>
    </article>
  </main>
</div>
<button id="secretBtn"></button>

<!-- ===== Ø§Ù„Ø´Ø§Øª ===== -->
<div id="chatScreen">
  <div id="lock">
    <div class="lockBox">
      <h3>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h3>
      <input id="pass" type="password" placeholder="Ø§Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
      <button onclick="unlock()">Ø¯Ø®ÙˆÙ„</button>
    </div>
  </div>

  <div class="chatBox">
    <header>ğŸ”’ Ø´Ø§Øª Ù…Ø´ÙØ± Ø°Ø§ØªÙŠ Ø§Ù„ØªØ¯Ù…ÙŠØ±</header>
    <div id="messages"></div>
    <footer>
      <input id="text" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©â€¦">
      <button onclick="send()">Ø¥Ø±Ø³Ø§Ù„</button>
      <button id="closeChat" onclick="closeChat()">Ø¥ØºÙ„Ø§Ù‚</button>
    </footer>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>
<script>
/* ===== Firebase Config ===== */
const firebaseConfig = {
  apiKey: "AIzaSyDBADAFbHjg8Dq10vR1l9yMImoBSFs_70M",
  authDomain: "todayquote-3a22b.firebaseapp.com",
  databaseURL: "https://todayquote-3a22b-default-rtdb.firebaseio.com",
  projectId: "todayquote-3a22b",
  storageBucket: "todayquote-3a22b.firebasestorage.app",
  messagingSenderId: "10962691980",
  appId: "1:10962691980:web:a38f4e91310cccba0998a9",
  measurementId: "G-WB9434WPCX"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();

/* ===== ÙØªØ­ Ø§Ù„Ø´Ø§Øª ===== */
secretBtn.onclick=()=>chatScreen.style.display='block';
function closeChat(){chatScreen.style.display='none';pass.value='';lock.style.display='flex'}

function unlock(){
 if(pass.value==='blobif') lock.style.display='none';
 else alert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
}

/* ===== User ID ===== */
const userId=localStorage.uid||(()=>{const x='u'+Math.random().toString(36).slice(2);localStorage.uid=x;return x})();

/* ===== ØªØ´ÙÙŠØ± AES ===== */
async function getKey(){
 if(localStorage.chatKey){
  const raw=Uint8Array.from(atob(localStorage.chatKey),c=>c.charCodeAt(0));
  return crypto.subtle.importKey('raw',raw,'AES-GCM',true,['encrypt','decrypt']);
 }
 const key=await crypto.subtle.generateKey({name:'AES-GCM',length:256},true,['encrypt','decrypt']);
 const raw=await crypto.subtle.exportKey('raw',key);
 localStorage.chatKey=btoa(String.fromCharCode(...new Uint8Array(raw)));
 return key;
}
async function encrypt(txt,key){
 const iv=crypto.getRandomValues(new Uint8Array(12));
 const enc=await crypto.subtle.encrypt({name:'AES-GCM',iv},key,new TextEncoder().encode(txt));
 return{m:btoa(String.fromCharCode(...new Uint8Array(enc))),iv:btoa(String.fromCharCode(...iv))};
}
async function decrypt(m,iv,key){
 const d=Uint8Array.from(atob(m),c=>c.charCodeAt(0));
 const i=Uint8Array.from(atob(iv),c=>c.charCodeAt(0));
 const dec=await crypto.subtle.decrypt({name:'AES-GCM',iv:i},key,d);
 return new TextDecoder().decode(dec);
}

/* ===== Ø¥Ø±Ø³Ø§Ù„ ===== */
async function send(){
 const t=text.value.trim(); if(!t)return; text.value='';
 const key=await getKey(); const e=await encrypt(t,key);
 const r=db.ref('chat').push();
 r.set({u:userId,m:e.m,iv:e.iv,ts:Date.now()});
 setTimeout(()=>r.remove(),5000); // ØªØ¯Ù…ÙŠØ± Ø°Ø§ØªÙŠ 5 Ø«ÙˆØ§Ù†ÙŠ
}

/* ===== Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ ===== */
const box=document.getElementById('messages');
db.ref('chat').on('child_added',async s=>{
 const d=s.val(); const key=await getKey();
 const txt=await decrypt(d.m,d.iv,key);
 const div=document.createElement('div');
 div.className='msg '+(d.u===userId?'me':'other');
 div.textContent=txt; box.appendChild(div);
 box.scrollTop=box.scrollHeight;
});
</script>
</body>
</html>
